# üö® CRITICAL: Branch Protection

**NEVER commit directly to `main` branch.** This is a production-critical rule.

Before ANY code changes:
1. Create branch: `git checkout -b issue/[N]-[description]`
2. Make changes and commit to the branch
3. Merge to main only after work is complete

Violating this rule can cause production impacts. A pre-commit hook will block direct commits to main.

---

# GitHub Issues Workflow

All work MUST be tracked via GitHub issues. Follow `.agent/workflows/context-gathering.md` for the complete workflow.

## Quick Rules
- **Start of session**: `gh issue list` to check open issues
- **New work**: Create issue first with `gh issue create`
- **Before coding**: Create branch `issue/[N]-[description]` - NEVER commit to `main`
- **During work**: Log progress with `gh issue comment [N] --body "..."`
- **Commits**: Prefix with issue number (e.g., `#1: Add feature...`)
- **Completion**: Merge to main, close issue, update CHANGELOG

## New Sessions
If you lack context about the codebase or issue, follow the **Issue Workflow** in `.agent/workflows/context-gathering.md`. This covers:
- Phase 1: Issue selection & branch setup
- Phase 2: Context gathering
- Phase 3: Implementation planning
- Phase 4: Execution
- Phase 5: Completion

**Ask clarifying questions** if the issue lacks sufficient detail.

## Planning (Complex Issues)
- **Claude Code CLI**: Use plan mode - plans auto-save to `.claude/plans/` and post to GitHub issues
- **Other AI tools**: Manually create `.claude/plans/issue-N-plan.md` and post with `gh issue comment`
- Plans are archived to `.claude/plans/archive/` with timestamps
- External reviews (Gemini/Codex CLI) also post to issues if available
- Search past plans: `grep -r "keyword" .claude/plans/archive/`

## Tool Consistency
All AI tools (Claude Code CLI, Google Antigravity, Cursor, etc.) should:
- Store plans in `.claude/plans/`
- Use branch format `issue/N-description`
- Commit with `#N:` prefix
- Log progress via `gh issue comment`

## ‚ö†Ô∏è CRITICAL: Infrastructure Protection

**NEVER modify production infrastructure without explicit user approval:**

1. **DigitalOcean Apps**: Do NOT use `apps-update` or `apps-create-app-from-spec` without:
   - First exporting the COMPLETE current spec and showing it to the user
   - Getting explicit approval for the specific changes
   - ONLY adding/modifying the specific fields needed, preserving ALL existing config
   - **Secrets cannot be read from the API - they will be overwritten with placeholders if you replace the spec**

2. **Database Changes**: Do NOT run migrations, schema changes, or destructive DB operations without user approval.

3. **Environment Variables**: When adding env vars to live apps, ALWAYS use the DigitalOcean console UI, or ask the user to do it manually. API updates replace the entire env var list.

4. **If you must modify infrastructure programmatically**:
   - Explain exactly what will change
   - List what will be preserved
   - Warn about any potential data loss (especially secrets)
   - Wait for explicit "proceed" from user
