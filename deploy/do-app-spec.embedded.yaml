# OptiRoute App Spec - EMBEDDED MODE
# Single service with dispatch functionality built into web-launcher
# Use this for demos, development, and low-traffic deployments

name: optiroute-web
region: nyc
services:
- name: web
  github:
    repo: imagicrafter/optiroute
    branch: feature/dispatch-service
    deploy_on_push: true
  source_dir: /
  build_command: npm install && npm run build && cd web-launcher && npm install && cd ../dispatch-service && npm install && npm run build
  run_command: node web-launcher/server.js
  http_port: 8080
  instance_size_slug: apps-s-1vcpu-0.5gb
  instance_count: 1
  envs:
  # Deployment mode - tells web-launcher to mount dispatch routes
  - key: DISPATCH_MODE
    value: embedded
    scope: RUN_TIME
  # Supabase Configuration
  - key: SUPABASE_URL
    value: https://vtaufnxworztolfdwlll.supabase.co
    scope: RUN_TIME
  - key: SUPABASE_KEY
    value: ***REMOVED_SUPABASE_ANON***
    scope: RUN_TIME
  - key: SUPABASE_SERVICE_ROLE_KEY
    value: ***REMOVED_SUPABASE_SECRET***
    scope: RUN_TIME
  - key: SUPABASE_SCHEMA
    value: routeiq
    scope: RUN_TIME
  # Google Maps
  - key: GOOGLE_MAPS_API_KEY
    value: ***REMOVED_GOOGLE_MAPS_KEY***
    scope: RUN_TIME
  # App Configuration
  - key: DEMO_PASSWORD
    value: demo123
    scope: RUN_TIME
  - key: SESSION_SECRET
    value: ***REMOVED_SESSION_SECRET***
    scope: RUN_TIME
  # Dispatch Configuration (embedded mode)
  - key: DISPATCH_API_KEYS
    type: SECRET
    scope: RUN_TIME
  - key: TELEGRAM_BOT_TOKEN
    type: SECRET
    scope: RUN_TIME
  - key: EMAIL_PROVIDER
    value: resend
    scope: RUN_TIME
  - key: RESEND_API_KEY
    type: SECRET
    scope: RUN_TIME
  - key: EMAIL_FROM_ADDRESS
    value: dispatch@optiroute.imagicrafterai.com
    scope: RUN_TIME
  - key: EMAIL_FROM_NAME
    value: OptiRoute Dispatch
    scope: RUN_TIME
  - key: NODE_ENV
    value: production
    scope: RUN_TIME
  health_check:
    http_path: /health
    initial_delay_seconds: 10
    period_seconds: 30
    timeout_seconds: 5
    success_threshold: 1
    failure_threshold: 3

domains:
- domain: optiroute.imagicrafterai.com
  type: PRIMARY
